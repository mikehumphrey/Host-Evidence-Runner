# Fix Summary - December 17, 2025

## Issue
Collection script was generating "Array variable has incorrect number of subscripts" errors during `-Verbose` mode, requiring manual intervention and preventing automated/scheduled execution.

## Root Cause
The script contained extensive `Write-Verbose` debug statements that were outputting complex object type information using `$object.GetType().FullName` syntax. While these statements are safe in normal operation, under certain conditions with verbose mode and large operations (30GB+ collections), the output handling could trigger display errors.

More importantly, the debug output created console dialogs that interrupted non-interactive execution, which is critical for:
- Scheduled task execution (Task Scheduler)
- Management tool automation  
- Unattended forensic collection

## Solutions Implemented

### 1. Removed All Verbose Debug Output
- Removed `Write-Verbose "DEBUG SafeJoinPath:..."` statements
- Removed `Write-Verbose "DEBUG Get-BinFile:..."` statements  
- Cleaned up all debug type information dumps
- **Result**: Cleaner, faster execution without unnecessary output

### 2. Production-Hardened the Script
- Added `$ProgressPreference = 'SilentlyContinue'` to suppress progress bars
- Changed `-Verbose` to be optional (not recommended for production)
- Ensured no interactive prompts or dialogs during execution
- **Result**: Works seamlessly with Task Scheduler and management tools

### 3. Updated Documentation
- Removed `-Verbose` from default instructions (now optional for debugging only)
- Added section on "Automated & Scheduled Execution"
- Included Windows Task Scheduler example
- Documented use with Group Policy / Management Tools
- **Result**: Clear guidance for both manual and automated use

## Testing
✅ Collection runs non-interactively
✅ Handles 30GB+ collections with automatic compression
✅ Auto-unblocks files after extraction from ZIP
✅ Works with scheduled tasks and management tools
✅ Comprehensive logging to files (not console)
✅ All artifacts continue to be collected even if individual items fail

## New Release
**Build**: `releases/20251217_083831/`
**ZIP Archive**: `releases/HER-Collector.zip`

## For Scheduled Execution

### Windows Task Scheduler
```powershell
$trigger = New-ScheduledTaskTrigger -Daily -At 2am
$action = New-ScheduledTaskAction -Execute "powershell.exe" -Argument `
  "-NoProfile -ExecutionPolicy Bypass -File C:\HER-Collector\run-collector.ps1 -AnalystWorkstation 'analyst-server'"
$principal = New-ScheduledTaskPrincipal -UserId "SYSTEM" -RunLevel Highest
Register-ScheduledTask -TaskName "HER-DailyCollection" -Trigger $trigger -Action $action -Principal $principal
```

### Manual Interactive (when needed)
```powershell
# Normal (production mode - no verbose output)
C:\HER-Collector\run-collector.ps1 -AnalystWorkstation "localhost"

# Debug mode (verbose output - NOT for production)
C:\HER-Collector\run-collector.ps1 -AnalystWorkstation "localhost" -Verbose
```

## Key Features Preserved
- ✅ Full forensic collection (MFT, logs, registry, browser history, etc.)
- ✅ Automatic robocopy transfer to analyst workstation
- ✅ ZIP compression (or skip with -NoZip for large collections)
- ✅ SHA256 hash manifests for chain of custody
- ✅ Detailed collection summary and logging
- ✅ Server role detection (DC, DNS, IIS, etc.)
- ✅ Error resilience (continues even if individual artifacts fail)
